#!/bin/sh
set -e
[ -f "$1" ] || { >&2 echo "usage: ${0##*/} <existing_script>"; exit 1; }
[ -x "$(which entr)" ] || exit 2
[ -x "$(which shellcheck)" ] || exit 3

tmux select-window -t "$1" 2>/dev/null ||
{
tmux new-window -n "$1" "vi $1 && tmux kill-window -t $1"
tmux split-window -p 40 -dh \
"ls $1 $1_test | entr -c sh -c 'fws $1 $1_test && shellcheck $1 $1_test && echo $1 && $1_test'"
}
