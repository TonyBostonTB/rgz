<!DOCTYPE html><html lang="en">
<head><title>macOS Keychain - Roman Zolotarev</title><meta charset="utf-8"><meta name="referrer" content="no-referrer"><link rel="stylesheet" href="/styles.css"><link rel="manifest" href="/manifest.webmanifest"><meta name="theme-color" content="#ffffff"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
</head>
<body><script>!function(t){ t.addEventListener('DOMContentLoaded', function () { var l = t.querySelector('#light-off'); if (l === null) { console.log('Lights-out...'); } else { l.checked = t.cookie.match(/lightOff=true/) !== null; l.addEventListener('change', function () { t.cookie = 'lightOff=' + JSON.stringify(l.checked) + ';path=/'; }); } })}(document);</script><input class="light-off" type="checkbox" id="light-off">
<div class="page">
<div class="header"><div class="header__home"><a href="/">Home</a> - <a href="https://twitter.com/romanzolotarev">Twitter</a></div><div class="header__light-off"><label for="light-off" class="light-off-button"></label></div></div>
<div class="article"><h1 id="macOS%20Keychain">macOS Keychain</h1>

<p>As a developer, you&#8217;re juggling many API keys and access tokens. Where
can you store them securely?</p>

<p>You can store arbitrary keys or tokens in the keychain built in to MacOS.
This solution only works on Macs, but it works out of the box on any Mac.</p>

<h2 id="Security%20for%20rescue">Security for rescue</h2>

<p><code>security</code> is a built-in command line interface to keychains and the
Security framework. To add a password to the default keychain, run:</p>

<pre><code class="language-bash">security add-generic-password -a ${USER} -s NAME -w
</code></pre>

<p>You have to specify your account name with <code>-a</code> and the service name with
<code>-s</code>. If you put <code>-w</code> at the end of the command you&#8217;ll be prompted to
enter the password.</p>

<p>To retrieve a password use:</p>

<pre><code class="language-bash">security find-generic-password -a ${USER} -s NAME -w
</code></pre>

<p>You can delete the password anytime:</p>

<pre><code class="language-bash">security delete-generic-password -a ${USER} -s NAME
</code></pre>

<h2 id="Use%20with%20a%20GitHub%20access%20token">Use with a GitHub access token</h2>

<p>Let&#8217;s use GitHub as an example. Add these functions to your <code>~/.bashrc</code></p>

<pre><code class="language-bash">function get_github_access_token () {
  local token
  token=$(curl -s https://api.github.com/authorizations \
      -H &quot;X-GitHub-OTP: ${1}&quot; \
      -u &quot;${USER}&quot; \
      -d &quot;{\&quot;scopes\&quot;: [\&quot;admin:public_key\&quot;], \&quot;note\&quot;: \&quot;$(hostname)-$(date +%s)\&quot;}&quot; \
      | jq -r .token)
  security delete-generic-password -a &quot;${USER}&quot; -s GitHub
  security add-generic-password -a &quot;${USER}&quot; -s GitHub -w &quot;$token&quot;
}

function add_ssh_key_to_github () {
  curl -s https://api.github.com/user/keys \
    -H &quot;Authorization: token $(security find-generic-password -a &quot;${USER}&quot; -s GitHub -w)&quot; \
    -d &quot;{\&quot;title\&quot;: \&quot;$(date +%s)\&quot;, \&quot;key\&quot;: \&quot;$(cat &quot;$1&quot;)\&quot;}&quot;
}

function list_github_ssh_keys () {
  curl -s https://api.github.com/user/keys \
    -H &quot;Authorization: token $(security find-generic-password -a &quot;${USER}&quot; -s GitHub -w)&quot; \
    | jq &#39;map({title: .title, key:.key})&#39;
}
</code></pre>

<p>Then call <code>get_github_access_token</code> function with your GitHub OTP code as
an argument, assuming you have enabled two-factor authentication for your
GitHub account. For example:</p>

<pre><code class="language-bash">get_github_access_token XXXXXX
</code></pre>

<p>Enter your GitHub password and <code>security</code> will add the new GitHub access
token to your keychain.</p>

<p><a href="/ssh/">Generate your SSH key pair first</a>. To add your public SSH key run
this command:</p>

<pre><code class="language-bash">add_ssh_key_to_github ~/.ssh/key.pub
</code></pre>

<p>Later you can list the SSH keys associated with your GitHub account:</p>

<pre><code class="language-bash">list_github_ssh_keys
</code></pre>

<p>To learn more, read the <code>security</code> man page:</p>

<pre><code class="language-bash">man security
</code></pre></div>
<div class="footer">&copy; <a href="/">Roman Zolotarev</a></div>
</div></body></html>
